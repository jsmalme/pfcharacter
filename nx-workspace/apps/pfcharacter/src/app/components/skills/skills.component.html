<div class="container comp-top-margin">
  <form [formGroup]="skillsForm" autocomplete="off">
    <ng-container formArrayName="skills">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" multiTemplateDataRows matSort matSortActive="name" matSortDirection="asc">
        <ng-container matColumnDef="favorite">
          <th mat-header-cell *matHeaderCellDef> Favorite </th>
          <td mat-cell *matCellDef="let skill" [formGroup]="skill" (click)="$event.stopPropagation()">
            <button mat-icon-button color="accent">
                <ng-container *ngIf="skill.controls.favorite.value">
                    <mat-icon>favorite</mat-icon>
                </ng-container>
                <ng-container *ngIf="!skill.controls.favorite.value">
                    <mat-icon>favorite_outline</mat-icon>
                </ng-container>
            </button>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="classSkill">
          <th mat-header-cell *matHeaderCellDef> Class Skill </th>
          <td mat-cell *matCellDef="let skill" [formGroup]="skill" (click)="$event.stopPropagation()">
            <mat-checkbox [checked]="skill.classSkill" formControlName="classSkill"></mat-checkbox>
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
          <td mat-cell *matCellDef="let skill" [formGroup]="skill">
            {{skill.controls.name.value}}
          </td>
        </ng-container>

        <ng-container matColumnDef="ability">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Ability </th>
            <td mat-cell *matCellDef="let skill" [formGroup]="skill">
              {{skill.controls.ability.value}}
            </td>
        </ng-container>
      
        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
          <td mat-cell *matCellDef="let skill" [formGroup]="skill" style="padding-top: 10px;">
            <div class="row">
              <div class="col-8">
                <app-total-display [isValid]="true"
                [total]="skill.controls.total.value" [showGreyZeros]="true">
                </app-total-display>
              </div>
              <div class="d-md-none col-4">
                <mat-icon *ngIf="!skill.isExpanded">arrow_drop_down</mat-icon>
                <mat-icon *ngIf="skill.isExpanded" color="accent">arrow_drop_up</mat-icon>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="abilityMod">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Mod </th>
            <td mat-cell *matCellDef="let skill" [formGroup]="skill" style="padding-left: 3px;">
               {{skill.controls.abilityMod.value}} 
            </td>
        </ng-container>

        <ng-container matColumnDef="class">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Class </th>
          <td mat-cell *matCellDef="let skill" [formGroup]="skill" style="padding-left: 3px;">
            {{skill.controls.classSkill.value ? 3 : 0}}
          </td>
        </ng-container>
      
        <ng-container matColumnDef="ranks">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Ranks </th>
            <td mat-cell *matCellDef="let skill" [formGroup]="skill">
              <mat-form-field appearance="outline" color="accent" style="width: 3.5em; text-align: center; margin: 0px 0px -1.25em">
                <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="ranks">
              </mat-form-field>
            </td>
        </ng-container>

        <ng-container matColumnDef="racial">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Racial </th>
            <td mat-cell *matCellDef="let skill" [formGroup]="skill">
              <mat-form-field appearance="outline" color="accent" style="width: 3.5em; text-align: center; margin: 0px 0px -1.25em">
                <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="racial">
              </mat-form-field>
            </td>
        </ng-container>

        <ng-container matColumnDef="misc">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Misc </th>
            <td mat-cell *matCellDef="let skill" [formGroup]="skill">
              <mat-form-field appearance="outline" color="accent" style="width: 3.5em; text-align: center; margin: 0px 0px -1.25em">
                <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="misc">
              </mat-form-field>
            </td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let skill" [formGroup]="skill" [attr.colspan]="displayedColumns.length">
              <div class="row queue-element-detail d-flex justify-content-center" [@detailExpand]="skill.isExpanded ? 'expanded' : 'collapsed'" [class]="skill.isExpanded ? 'marginTop' : ''">
                <div class="col d-flex justify-content-center">
                  <mat-form-field class="text-center" appearance="outline" color="accent"  style="width: 5em;">
                    <mat-label>Ranks</mat-label>
                    <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="ranks">
                  </mat-form-field>
                </div>

                <div class="col d-flex justify-content-center">
                  <mat-form-field class="text-center" appearance="outline" color="accent"  style="width: 5em;">
                    <mat-label>Racial</mat-label>
                    <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="racial">
                  </mat-form-field>
                </div>

                <div class="col d-flex justify-content-center">
                  <mat-form-field class="text-center" appearance="outline" color="accent"  style="width: 5em;">
                    <mat-label>Misc</mat-label>
                    <input matInput inputmode="numeric" type="text" pattern="-?[0-9]*" formControlName="misc">
                  </mat-form-field>
                </div>

                <div class="col d-flex justify-content-center">
                  <mat-form-field class="text-center" appearance="outline" color="accent"  style="width: 5em;">
                    <mat-label>Ability</mat-label>
                    <input matInput value="{{skill.controls.abilityMod.value}}" disabled="disabled">
                  </mat-form-field>
                </div>

                <div class="col d-flex justify-content-center">
                  <mat-form-field class="text-center" appearance="outline" color="accent"  style="width: 5em;">
                    <mat-label>Class</mat-label>
                    <input matInput value="{{skill.controls.classSkill.value ? 3 : 0}}" disabled="disabled">
                  </mat-form-field>
                </div>
              </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" style="background-color: #2e7d32;"></tr>
        <tr mat-row *matRowDef="let skill; columns: displayedColumns;" class="d-none d-md-table-row"></tr>
        <!-- mobile screen row expansion -->
        <tr mat-row *matRowDef="let skill; columns: displayedColumns;"
            class="d-table-row d-md-none queue-element-row"
            [class.queue-expanded-row]="skill.isExpanded"
            (click)="skill.isExpanded = !skill.isExpanded"
            [ngClass]="skill.isExpanded ? 'expanded-row' : null"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']"
            class="d-table-row d-md-none queue-detail-row"></tr>
      </table>
    </ng-container>
  </form>
</div>